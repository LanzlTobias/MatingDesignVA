# Simulation Repository
This repository contains the code and instructions to reproduce the simulation described in the paper.

## Setup
1. Clone the repository to your local machine.
2. Set the working directory in each script by modifying the function *setwd('~/LD/Paper/')* and replace *'~/LD/Paper/'* with the path to your home directory.
3. Create two new directories called *input* and *scripts* and copy the respective files from the repository's */input* and */scripts* directories into them.
4. Create an empty directory called output to store the output generated by the scripts.

## Running the Main Simulation
To run the main simulation described in the paper, execute the *main_simulation.R* script. This script can be parallelized to significantly reduce processing time. Modify the *"workers"* argument in the function *plan(multicore, workers = 1)* (line 18) to specify the number of threads suitable for your machine. The script will generate the file *main_sim_result.csv*, which will be saved in the */output* directory.

## Summarizing the Results
To calculate the means and standard errors of all parameters over all combinations of replication and set, run the *ANOVA_Mean.R* script. Similar to the main simulation script, this script can be parallelized. Adjust the *"workers"* argument in the function *plan(multicore, workers = 1)* to set the desired number of threads. The output will be saved as *summary_df.RData* in the */output* directory. Additionally, the results of all variance components will be saved in */output* as *ANOVA_df.RData*.

## Appendix and Figures
To verify the formulas in Appendix A and generate the data for figures S7 and S8, execute the *Appendix_A.R* script. The output will be saved as *Appendix_A.RData* and *Appendix_A_negative_prob.RData* in the */output* directory.

To generate the data for figure S1, run the *figure_S1.R* script. The output will be saved as *figS1_expectation.RData* and *figS1_simulation.RData* in the */output* directory.

To calculate the input for figure S9, run the *D_distributions.R* script. The output will be saved in */output* as *D_ancestral.RData*.

## Generating Figures
The code for generating all figures and supplements can be found in *figures.Rmd*. Create an empty directory called *figures* and run the script to generate all figures as seen in the paper. Ensure that all output files generated from the previous scripts are available.

## Script Descriptions and Input File
- *LD_decay.R*: Script for calculating the decay of GPD in the ancestral populations.
- *R_functions.R*: Source file for the custom functions written in R.
- *cpp_functions.cpp*: Source file for the custom functions written in C++.
- *main_simulation.R*: Script for running the main simulation. Requires the source files in R and C++, as well as the input *founding_pop.RData*. This script can be parallelized by adjusting the number of workers.
- *ANOVA_Mean.R*: Script for summarizing the output of the main simulation. Performs an ANOVA for each setting and calculates the means and standard errors. Parallelization is possible by adjusting the number of workers.
- *preparatory_sim.R*: Essentially, *main_simulation.R* for 100 replications and 100 sets of QTL positions. Used to estimate the variance components of the number of sets and the number of replications.
- *preparatory_sim_analysis.R*: Essentially, *ANOVA_Mean.R* for the output of *preparatory_sim.R*.
- *Appendix_A.R*: Tests the formulas in Appendix A.
- *figure_S2.R*: Simulation for the data used in figure S2.
- *D_distributions.R*: Calculates the off-diagonal values of the matrix D in the ancestral populations.
- *figures.Rmd*: R Notebook containing the code for generating the figures in the paper.
- *founding_pop.RData*: Input file for the main simulation. Contains masked information for the coding of the genotypes.
Please refer to the paper for more detailed information about the simulation and its results.

